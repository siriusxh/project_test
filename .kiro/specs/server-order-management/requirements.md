# 需求文档

## 介绍

服务器订单管理系统是一个用于管理向供应商采购服务器订单的Web应用程序。该系统帮助用户根据框架协议价格拆解业务需求、计算成本、创建订单，并跟踪需求、Jira案例、EPS订单和预算代码之间的关联关系。系统使用文件型数据库以支持云盘同步，确保数据在多台计算机之间保持一致。

## 术语表

- **系统 (System)**: 服务器订单管理系统
- **SKU (Stock Keeping Unit)**: 库存单位，用于标识服务器或配件的唯一编码
- **框架协议 (Framework Agreement)**: 与服务器厂商签订的包含固定SKU和单价的采购协议
- **需求 (Requirement)**: 业务方提出的服务器采购需求
- **配置 (Configuration)**: 服务器的具体规格组合，包含多个SKU和数量
- **Jira Case**: 与采购需求关联的Jira工单编号
- **EPS订单 (EPS Order)**: 向供应商下达的实际采购订单
- **预算Code (Budget Code)**: 用于分摊订单费用的预算编码
- **用户 (User)**: 使用系统的采购人员或管理人员

## 需求

### 需求 1

**用户故事:** 作为采购人员，我想要管理框架协议价格数据，以便在计算订单时引用准确的SKU和单价信息

#### 验收标准

1. 当系统启动时，系统应加载存储在文件型数据库中的所有框架协议价格数据
2. 当用户添加新的SKU记录时，系统应验证SKU编码的唯一性并存储SKU编码、名称、单价和供应商信息
3. 当用户修改现有SKU的单价时，系统应更新数据库中的价格信息并保留修改历史
4. 当用户查询SKU时，系统应支持按SKU编码、名称或供应商进行搜索并返回匹配结果
5. 当数据库文件被修改时，系统应将更改持久化到文件以支持云盘同步

### 需求 2

**用户故事:** 作为采购人员，我想要创建和拆解新的采购需求，以便计算不同配置方案的总价

#### 验收标准

1. 当用户创建新需求时，系统应生成唯一的需求ID并关联Jira Case编号
2. 当用户为需求添加配置方案时，系统应允许通过下拉框或搜索选择SKU并输入数量
3. 当用户选择SKU并输入数量时，系统应根据框架协议单价自动计算该行项目的小计金额
4. 当一个需求包含多个配置方案时，系统应分别计算每个配置的总价并显示汇总金额
5. 当用户保存需求时，系统应将需求及其所有配置方案存储到数据库中

### 需求 3

**用户故事:** 作为采购人员，我想要将需求转换为EPS订单，以便向不同供应商下达采购订单

#### 验收标准

1. 当用户从需求创建EPS订单时，系统应根据选择的服务器品牌将需求拆分为一个或多个订单
2. 当创建EPS订单时，系统应生成唯一的EPS订单编号并关联到原始需求ID
3. 当用户为EPS订单分配预算Code时，系统应允许添加一个或多个预算Code并记录分摊比例
4. 当EPS订单包含多个预算Code时，系统应验证分摊比例总和为100%
5. 当用户保存EPS订单时，系统应将订单信息、关联的需求ID、Jira Case和预算Code存储到数据库中

### 需求 4

**用户故事:** 作为管理人员，我想要查询和筛选历史订单，以便追踪采购记录和分析支出

#### 验收标准

1. 当用户访问订单查询页面时，系统应显示所有历史订单的列表视图
2. 当用户按需求ID筛选时，系统应返回该需求关联的所有EPS订单和配置信息
3. 当用户按Jira Case筛选时，系统应返回该案例关联的所有需求和订单
4. 当用户按EPS订单编号筛选时，系统应返回该订单的详细信息包括SKU明细和预算Code分摊
5. 当用户按预算Code筛选时，系统应返回使用该预算Code的所有订单并计算总支出金额

### 需求 5

**用户故事:** 作为管理人员，我想要查看统计汇总信息，以便了解采购支出的整体情况

#### 验收标准

1. 当用户访问统计页面时，系统应显示按供应商分组的订单总额统计
2. 当用户选择时间范围时，系统应筛选该时间段内的订单并重新计算统计数据
3. 当用户查看预算Code统计时，系统应显示每个预算Code的已使用金额和订单数量
4. 当用户查看SKU统计时，系统应显示每个SKU的采购总量和总金额
5. 当统计数据更新时，系统应提供导出功能以生成Excel或CSV格式的报表

### 需求 6

**用户故事:** 作为用户，我想要系统使用文件型数据库，以便通过云盘在多台计算机之间同步数据

#### 验收标准

1. 当系统初始化时，系统应使用SQLite作为文件型数据库并创建数据库文件
2. 当数据库文件不存在时，系统应自动创建数据库文件并初始化表结构
3. 当用户进行任何数据修改操作时，系统应立即将更改提交到数据库文件
4. 当数据库文件被外部修改（如云盘同步）时，系统应在下次查询时读取最新数据
5. 当系统检测到数据库文件损坏时，系统应显示错误信息并提供数据恢复建议

### 需求 7

**用户故事:** 作为用户，我想要通过Web界面操作系统，以便方便地访问和使用各项功能

#### 验收标准

1. 当系统启动时，系统应启动Web服务器并在指定端口提供HTTP服务
2. 当用户访问根URL时，系统应显示主导航页面包含所有功能模块的入口
3. 当用户在Web页面提交表单时，系统应验证输入数据的完整性和有效性
4. 当操作成功完成时，系统应显示成功消息并刷新相关数据视图
5. 当操作失败时，系统应显示清晰的错误消息并保持用户已输入的数据

### 需求 8

**用户故事:** 作为用户，我想要系统保持数据完整性，以便确保需求、订单和预算之间的关联关系准确无误

#### 验收标准

1. 当删除需求时，系统应检查是否存在关联的EPS订单并阻止删除或提供级联删除选项
2. 当修改SKU单价时，系统应保留历史价格记录并标记使用旧价格的订单
3. 当创建EPS订单时，系统应验证关联的需求ID存在于数据库中
4. 当分配预算Code时，系统应验证预算Code格式的有效性
5. 当查询关联数据时，系统应确保返回的需求、Jira Case、EPS订单和预算Code之间的关联关系完整且一致
