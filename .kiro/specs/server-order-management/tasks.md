# 实施计划

- [x] 1. 设置项目结构和核心配置





  - 创建Flask应用目录结构（app/, models/, services/, repositories/, templates/, static/）
  - 创建配置文件管理（config.py支持开发/生产环境）
  - 配置SQLAlchemy和SQLite数据库连接
  - 设置日志系统（logging配置）
  - 创建Flask应用工厂函数
  - _需求: 6.1, 6.2, 7.1_

- [x] 2. 实现数据模型和数据库初始化





  - 使用SQLAlchemy定义所有数据模型（SKU, Requirement, Configuration, EPSOrder等）
  - 实现模型之间的外键关系和级联规则
  - 添加数据库索引优化查询性能（sku_code, requirement_code, order_code等）
  - 创建数据库初始化脚本（init_db.py）
  - _需求: 1.1, 6.1, 6.2_

- [x] 2.1 编写数据持久化往返属性测试


  - **属性 4: 数据持久化往返一致性**
  - **验证需求: 1.5, 2.5, 3.5, 6.3**

- [x] 3. 实现SKU管理功能





  - 创建SKURepository实现CRUD操作
  - 实现SKU搜索功能（按编码、名称、供应商）
  - 实现SKU价格更新和PriceHistory记录功能
  - 创建SKU管理的Web页面（列表、创建、编辑表单）
  - 实现SKU搜索的AJAX接口
  - _需求: 1.2, 1.3, 1.4_

- [x] 3.1 编写SKU唯一性属性测试


  - **属性 1: SKU编码唯一性**
  - **验证需求: 1.2**

- [x] 3.2 编写价格变更历史属性测试

  - **属性 2: 价格变更历史完整性**
  - **验证需求: 1.3, 8.2**

- [x] 3.3 编写SKU搜索属性测试

  - **属性 3: SKU搜索结果匹配性**
  - **验证需求: 1.4**

- [x] 4. 实现需求管理和配置拆解功能







  - 创建RequirementRepository和ConfigurationRepository
  - 实现PriceCalculationService计算配置价格
  - 创建需求创建和编辑的Web页面
  - 实现配置方案的动态添加和SKU选择（AJAX）
  - 实现配置项小计和配置总价的自动计算（前端+后端）
  - _需求: 2.1, 2.3, 2.4, 2.5_

- [x] 4.1 编写需求ID唯一性属性测试


  - **属性 5: 需求ID唯一性**
  - **验证需求: 2.1**

- [x] 4.2 编写配置项小计计算属性测试





  - **属性 6: 配置项小计计算正确性**
  - **验证需求: 2.3**

- [x] 4.3 编写配置总价计算属性测试


  - **属性 7: 配置总价计算正确性**
  - **验证需求: 2.4**
-

- [x] 5. 实现EPS订单管理功能








  - 创建OrderRepository实现订单CRUD操作
  - 实现OrderService的订单拆分逻辑（按供应商）
  - 实现预算Code分配功能和比例验证
  - 创建订单创建和编辑的Web页面
  - 实现预算分配的动态添加界面
  - _需求: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 5.1 编写订单拆分完整性属性测试








  - **属性 8: 订单拆分完整性**
  - **验证需求: 3.1**

- [x] 5.2 编写EPS订单编号唯一性属性测试



  - **属性 9: EPS订单编号唯一性**
  - **验证需求: 3.2**

- [x] 5.3 编写预算分配比例验证属性测试



  - **属性 10: 预算分配比例总和验证**
  - **验证需求: 3.4**

- [-] 6. 实现订单查询和筛选功能



  - 创建订单查询页面显示所有历史订单
  - 实现多维度筛选（需求ID、Jira Case、订单编号、预算Code）
  - 实现订单详情查询显示完整关联信息
  - 添加分页和排序功能
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 6.1 编写需求ID筛选属性测试


  - **属性 11: 需求ID筛选完整性**
  - **验证需求: 4.2**

- [x] 6.2 编写Jira Case筛选属性测试


  - **属性 12: Jira Case筛选完整性**
  - **验证需求: 4.3**

- [x] 6.3 编写订单详情查询属性测试


  - **属性 13: 订单详情查询完整性**
  - **验证需求: 4.4**

- [x] 6.4 编写预算Code筛选和汇总属性测试



  - **属性 14: 预算Code筛选和金额汇总正确性**
  - **验证需求: 4.5**

- [x] 7. 实现统计汇总功能







  - 创建StatisticsService实现各维度统计
  - 实现按供应商、预算Code、SKU的统计汇总
  - 实现时间范围筛选
  - 创建统计页面显示汇总数据（表格和图表）
  - 实现Excel和CSV导出功能（使用openpyxl和csv模块）
  - _需求: 5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 7.1 编写统计聚合计算属性测试


  - **属性 15: 统计聚合计算正确性**
  - **验证需求: 5.1, 5.3, 5.4**

- [x] 7.2 编写时间范围筛选属性测试


  - **属性 16: 时间范围筛选正确性**
  - **验证需求: 5.2**

- [x] 7.3 编写统计数据导出往返属性测试


  - **属性 17: 统计数据导出往返一致性**
  - **验证需求: 5.5**

- [-] 8. 实现数据完整性和验证功能



  - 实现DataIntegrityService检查引用完整性
  - 实现外键存在性验证
  - 实现级联删除或删除阻止逻辑
  - 实现表单输入验证（使用WTForms）
  - 添加预算Code格式验证
  - 实现全局异常处理器（ValidationError, BusinessLogicError, DatabaseError）
  - _需求: 8.1, 8.3, 8.4, 8.5, 7.3_

- [x] 8.1 编写引用完整性约束属性测试


  - **属性 21: 引用完整性约束**
  - **验证需求: 8.1**

- [x] 8.2 编写外键存在性验证属性测试


  - **属性 22: 外键存在性验证**
  - **验证需求: 8.3**

- [x] 8.3 编写关联数据查询一致性属性测试



  - **属性 23: 关联数据查询一致性**
  - **验证需求: 8.5**

- [x] 8.4 编写表单输入验证属性测试




  - **属性 19: 表单输入验证**
  - **验证需求: 7.3, 8.4**

- [-] 9. 实现前端界面和用户体验


  - 创建基础模板（base.html）和主导航页面
  - 使用Bootstrap 5美化所有页面
  - 实现表单的客户端验证（JavaScript）
  - 添加Flash消息显示成功/错误提示
  - 实现操作失败时的数据保留（表单回填）
  - 优化移动端响应式显示
  - _需求: 7.2, 7.4, 7.5_

- [x] 9.1 编写操作失败数据保留属性测试


  - **属性 20: 操作失败时数据保留**
  - **验证需求: 7.5**

- [x] 10. 实现数据库同步和错误处理







  - 实现数据库文件外部修改检测和刷新机制
  - 配置日志记录系统（app.log和error.log）
  - 添加数据库损坏检测和错误提示
  - 实现日志文件自动轮转
  - _需求: 6.4, 6.5_


- [x] 10.1 编写数据库外部修改同步属性测试

  - **属性 18: 数据库文件外部修改同步**
  - **验证需求: 6.4**

- [x] 11. 第一次检查点 - 确保所有测试通过





  - 确保所有测试通过，如有问题请询问用户

- [x] 12. 创建初始数据和示例




  - 创建数据库初始化脚本（seed_data.py）
  - 添加示例SKU数据（服务器、内存、硬盘、网卡等）
  - 创建示例需求和订单用于演示
  - _需求: 1.1_

- [x] 13. 配置部署和运行环境



  - 创建requirements.txt列出所有依赖
  - 编写README.md说明安装和使用步骤
  - 创建启动脚本（run.py）
  - 配置Waitress作为WSGI服务器（生产环境）
  - 添加数据库文件路径配置（支持云盘目录）
  - _需求: 6.1, 7.1_

- [x] 14. 最终检查点 - 确保所有测试通过





  - 确保所有测试通过，如有问题请询问用户
